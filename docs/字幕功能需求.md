# AI 语音讲解与字幕系统需求文档

## 1. 核心逻辑 (Core Logic)
*   **工序独立字幕**：每道工序（Process）支持一段独立的文字讲解词。
*   **AI 讲解模式切换**：
    *   主界面增加“AI 讲解模式”全局开关（默认关闭）。
    *   **开启后**：自动开启“循环播放”且置灰（不可取消），视频播放与字幕长度挂钩。
    *   **关闭后**：恢复普通对比/播放逻辑。
*   **可调语速与存储**：
    *   主界面支持动态调节语速（3.0 - 7.0 字/秒），默认 5.0。
    *   语速配置保存于 `projects` 表的 `narration_speed` 字段，实现项目级同步。
*   **内容时长估算**：
    *   计算公式：`预计讲解时长 = 总字数 / 当前设定语速`。
*   **智能循环逻辑 (Smart Wait)**：
    *   前提：改善前后视频必须**至少完整播放 1 次**。
    *   逻辑：当视频片段结束时，若`已播时间 < 预计讲解时长`，则视频返回片段起点重新播放，直到讲解时长消耗完毕，才允许跳转下一工序。
*   **内容共享**：在“对比播放”模式下，改善前后视频公用同一段讲解词。

## 2. 数据存储 (Data & Persistence)
*   **DB 扩展**：`processes` 表增加 `subtitle_text` 字段（TEXT类型）。
*   **API 适配**：修改 Electron IPC 接口，确保字幕内容的读取与保存。

## 3. 字幕编辑器 (Subtitle Editor)
*   **编辑界面**：在 `ProcessEditor`（工序编辑器）右侧表单增加“语音讲解词/字幕”多行文本框。
*   **实时反馈**：
    *   显示当前字数。
    *   实时显示“预计播报时间”（秒）。
    *   对比显示“视频时长”与“预计播报时间”，若讲解词过长，给用户一个黄色提醒。

## 4. 浮动字幕 UI (Interactive Overlay)
*   **悬浮容器**：在 `ComparePlayer` 和 `VideoPlayer` 中增加一个悬浮层组件。
*   **可交互性**：
    *   **可拖拽**：用户可以点击字幕区域，将其移动到屏幕任何位置。
    *   **调整大小**：支持调节字体大小和显示区域。
*   **视觉设计**：
    *   采用“毛玻璃”半透明黑底白字效果。
    *   支持文字逐字出现效果，与模拟播报进度同步。

## 5. 语音 TTS 预留 (Future TTS)
*   **接口标准化**：封装 `SpeechManager` 工具类，当前使用计时器模拟播报进度。
