# KaizenShowcase ä¼˜åŒ–æ¸…å•

> é¡¹ç›®å½“å‰å®Œæˆåº¦ï¼š**85%**
> æ–‡æ¡£ç”Ÿæˆæ—¥æœŸï¼š2024å¹´12æœˆ24æ—¥

---

## é¡¹ç›®æ¦‚å†µ

| æŒ‡æ ‡ | çŠ¶æ€ |
|------|------|
| æ ¸å¿ƒåŠŸèƒ½ | âœ… å·²å®Œæˆ |
| ä»£ç è´¨é‡ | âš ï¸ éœ€ä¼˜åŒ– |
| å®‰å…¨æ€§ | âŒ æœ‰é—®é¢˜ |
| æµ‹è¯•è¦†ç›– | âŒ æ— æµ‹è¯• |
| ç”¨æˆ·ä½“éªŒ | âš ï¸ å¯æå‡ |
| ç”Ÿäº§å°±ç»ª | âŒ æœªå°±ç»ª |

---

## ä¼˜åŒ–æ¸…å•

### P0 - å¿…é¡»ä¿®å¤ï¼ˆå®‰å…¨/ç¨³å®šæ€§é—®é¢˜ï¼‰

#### 1. âŒ å®‰å…¨æ¼æ´ï¼šwebSecurity å…³é—­

**ä½ç½®**: `electron/main.js:19`

```javascript
// å½“å‰ä»£ç 
webPreferences: {
  webSecurity: false  // âš ï¸ ä¸¥é‡å®‰å…¨éšæ‚£
}
```

**é—®é¢˜**:
- å…³é—­ webSecurity å…è®¸ä»»æ„è·¨åŸŸè¯·æ±‚
- å­˜åœ¨æœ¬åœ°æ–‡ä»¶æ³„éœ²é£é™©
- å¯èƒ½è¢«æ¶æ„è„šæœ¬åˆ©ç”¨

**ä¿®å¤æ–¹æ¡ˆ**:
```javascript
webPreferences: {
  webSecurity: true,  // ä¿æŒå¼€å¯
  contextIsolation: true,
  nodeIntegration: false,
  preload: path.join(__dirname, 'preload.js')
}
```
é…åˆæ­£ç¡®é…ç½®çš„ `local-video://` åè®®å³å¯åŠ è½½æœ¬åœ°è§†é¢‘ï¼Œæ— éœ€å…³é—­ webSecurityã€‚

---

#### 2. âŒ ç¼ºå°‘å…¨å±€é”™è¯¯å¤„ç†

**é—®é¢˜**: æ‰€æœ‰ async å‡½æ•°éƒ½æ²¡æœ‰ try-catchï¼Œåº”ç”¨å¯èƒ½é™é»˜å¤±è´¥

**å½±å“æ–‡ä»¶**:
- `src/components/ProjectList.jsx` - loadProjects, handleCreateProject, handleDeleteProject
- `src/components/StageManager.jsx` - loadStages, handleCreateStage, handleDeleteStage
- `src/components/ProcessList.jsx` - handleCreateProcess, handleUpdateProcess, handleDeleteProcess
- `src/components/ComparePlayer.jsx` - handlePlay, playNextProcess, playPrevProcess
- `src/components/VideoPlayer.jsx` - handlePlay
- `src/App.jsx` - loadProcesses

**ä¿®å¤æ–¹æ¡ˆ**:

1. æ·»åŠ  React Error Boundary:
```jsx
// src/components/ErrorBoundary.jsx
class ErrorBoundary extends React.Component {
  state = { hasError: false, error: null };

  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }

  render() {
    if (this.state.hasError) {
      return <div className="error-page">å‡ºé”™äº†: {this.state.error?.message}</div>;
    }
    return this.props.children;
  }
}
```

2. ä¸ºæ¯ä¸ª async å‡½æ•°æ·»åŠ  try-catch:
```javascript
const loadProjects = async () => {
  try {
    const allProjects = await window.electronAPI.getAllProjects();
    setProjects(allProjects);
  } catch (error) {
    console.error('åŠ è½½é¡¹ç›®å¤±è´¥:', error);
    // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
  }
};
```

---

### P1 - é«˜ä¼˜å…ˆçº§ï¼ˆå½±å“ç”¨æˆ·ä½“éªŒï¼‰

#### 3. âš ï¸ ä½¿ç”¨åŸç”Ÿ confirm å¯¹è¯æ¡†

**ä½ç½®**:
- `src/components/ProjectList.jsx:39`
- `src/components/StageManager.jsx:42`
- `src/components/ProcessList.jsx:74`

```javascript
// å½“å‰ä»£ç 
if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé¡¹ç›®å—ï¼Ÿ'))
```

**é—®é¢˜**:
- æ ·å¼ä¸åº”ç”¨ä¸ç»Ÿä¸€
- æ— æ³•è‡ªå®šä¹‰æŒ‰é’®æ–‡å­—
- ç”¨æˆ·ä½“éªŒå·®

**ä¿®å¤æ–¹æ¡ˆ**: åˆ›å»ºè‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†ç»„ä»¶
```jsx
// src/components/ConfirmDialog.jsx
function ConfirmDialog({ isOpen, title, message, onConfirm, onCancel }) {
  if (!isOpen) return null;
  return (
    <div className="modal-overlay">
      <div className="modal confirm-dialog">
        <h3>{title}</h3>
        <p>{message}</p>
        <div className="modal-actions">
          <button className="btn-secondary" onClick={onCancel}>å–æ¶ˆ</button>
          <button className="btn-danger" onClick={onConfirm}>ç¡®è®¤åˆ é™¤</button>
        </div>
      </div>
    </div>
  );
}
```

---

#### 4. âš ï¸ å·¥å…·å‡½æ•°é‡å¤å®šä¹‰

**é—®é¢˜**: `formatTime` å’Œ `formatTimeSaved` å‡½æ•°åœ¨å¤šä¸ªæ–‡ä»¶ä¸­é‡å¤

**é‡å¤ä½ç½®**:
- `src/components/ProcessList.jsx:18-33`
- `src/components/VideoPlayer.jsx:84-99`
- `src/components/ComparePlayer.jsx:270-285`

**ä¿®å¤æ–¹æ¡ˆ**: åˆ›å»ºå·¥å…·å‡½æ•°åº“
```javascript
// src/utils/time.js
export const formatTime = (seconds) => {
  const mins = Math.floor(seconds / 60);
  const secs = Math.floor(seconds % 60);
  return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
};

export const formatTimeDetailed = (seconds) => {
  const mins = Math.floor(seconds / 60);
  const secs = (seconds % 60).toFixed(1);
  return mins > 0 ? `${mins}åˆ†${secs}ç§’` : `${secs}ç§’`;
};

export const formatTimeSaved = (timeSaved) => {
  if (!timeSaved || timeSaved === 0) return 'æ— å˜åŒ–';
  const absTime = Math.abs(timeSaved);
  const timeStr = formatTime(absTime);
  return timeSaved > 0 ? `èŠ‚çœ ${timeStr}` : `å¢åŠ  ${timeStr}`;
};
```

---

#### 5. âš ï¸ ç¼ºå°‘ Loading çŠ¶æ€

**é—®é¢˜**: æ•°æ®åŠ è½½æ—¶ç”¨æˆ·æ— æ„ŸçŸ¥ï¼Œä½“éªŒå·®

**éœ€è¦æ·»åŠ  Loading çš„ä½ç½®**:
- é¡¹ç›®åˆ—è¡¨åŠ è½½
- é˜¶æ®µåˆ—è¡¨åŠ è½½
- å·¥åºåˆ—è¡¨åŠ è½½
- è§†é¢‘åŠ è½½

**ä¿®å¤æ–¹æ¡ˆ**:
```jsx
const [isLoading, setIsLoading] = useState(false);

const loadProjects = async () => {
  setIsLoading(true);
  try {
    const allProjects = await window.electronAPI.getAllProjects();
    setProjects(allProjects);
  } finally {
    setIsLoading(false);
  }
};

// æ¸²æŸ“
{isLoading ? <LoadingSpinner /> : <ProjectGrid projects={projects} />}
```

---

#### 6. âš ï¸ ç¼ºå°‘ç±»å‹æ£€æŸ¥

**é—®é¢˜**: æ²¡æœ‰ PropTypes æˆ– TypeScriptï¼Œå®¹æ˜“äº§ç”Ÿè¿è¡Œæ—¶é”™è¯¯

**ä¿®å¤æ–¹æ¡ˆA - æ·»åŠ  PropTypesï¼ˆå¿«é€Ÿï¼‰**:
```jsx
import PropTypes from 'prop-types';

ProjectList.propTypes = {
  onProjectSelect: PropTypes.func.isRequired
};

ComparePlayer.propTypes = {
  process: PropTypes.object,
  processes: PropTypes.array,
  stage: PropTypes.object.isRequired,
  layoutMode: PropTypes.oneOf(['horizontal', 'vertical']),
  globalMode: PropTypes.bool,
  onProcessChange: PropTypes.func
};
```

**ä¿®å¤æ–¹æ¡ˆB - è¿ç§» TypeScriptï¼ˆæ¨èï¼‰**:
```typescript
interface Process {
  id: number;
  name: string;
  before_start_time: number;
  before_end_time: number;
  after_start_time: number;
  after_end_time: number;
  time_saved: number;
  process_type: 'normal' | 'new_step' | 'cancelled';
}

interface ComparePlayerProps {
  process?: Process;
  processes?: Process[];
  stage: Stage;
  layoutMode: 'horizontal' | 'vertical';
  globalMode?: boolean;
  onProcessChange?: (process: Process) => void;
}
```

---

### P2 - ä¸­ä¼˜å…ˆçº§ï¼ˆåŠŸèƒ½å¢å¼ºï¼‰

#### 7. ğŸ”§ ç¼ºå°‘å•å…ƒæµ‹è¯•

**å½“å‰çŠ¶æ€**: æ— ä»»ä½•æµ‹è¯•æ–‡ä»¶

**å»ºè®®æ·»åŠ **:
- å•å…ƒæµ‹è¯•: Jest + React Testing Library
- E2Eæµ‹è¯•: Playwright æˆ– Cypress
- ç›®æ ‡è¦†ç›–ç‡: 70%+

**æµ‹è¯•æ–‡ä»¶ç»“æ„**:
```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ __tests__/
â”‚   â”‚   â”œâ”€â”€ ProjectList.test.jsx
â”‚   â”‚   â”œâ”€â”€ StageManager.test.jsx
â”‚   â”‚   â”œâ”€â”€ ProcessList.test.jsx
â”‚   â”‚   â”œâ”€â”€ VideoPlayer.test.jsx
â”‚   â”‚   â””â”€â”€ ComparePlayer.test.jsx
â”‚   â””â”€â”€ ...
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ __tests__/
â”‚       â””â”€â”€ time.test.js
â””â”€â”€ ...
```

---

#### 8. ğŸ”§ çŠ¶æ€ç®¡ç†éœ€è¦ä¼˜åŒ–

**å½“å‰é—®é¢˜**:
- æ‰€æœ‰çŠ¶æ€é›†ä¸­åœ¨ `App.jsx`
- Props å±‚å±‚ä¼ é€’ï¼ˆprops drillingï¼‰
- éš¾ä»¥æ‰©å±•

**ä¿®å¤æ–¹æ¡ˆ - ä½¿ç”¨ React Context**:
```jsx
// src/context/AppContext.jsx
const AppContext = createContext();

export function AppProvider({ children }) {
  const [currentProject, setCurrentProject] = useState(null);
  const [currentStage, setCurrentStage] = useState(null);
  const [processes, setProcesses] = useState([]);

  return (
    <AppContext.Provider value={{
      currentProject, setCurrentProject,
      currentStage, setCurrentStage,
      processes, setProcesses
    }}>
      {children}
    </AppContext.Provider>
  );
}

export const useApp = () => useContext(AppContext);
```

---

#### 9. ğŸ”§ å·¥åºæ— æ³•æ‹–æ‹½æ’åº

**å½“å‰çŠ¶æ€**: åªèƒ½é€šè¿‡æ•°æ®åº“ sort_order å­—æ®µæ’åºï¼Œå‰ç«¯æ— æ³•äº¤äº’

**ä¿®å¤æ–¹æ¡ˆ**: ä½¿ç”¨ `@dnd-kit/core` æˆ– `react-beautiful-dnd`

```jsx
import { DndContext, closestCenter } from '@dnd-kit/core';
import { SortableContext, verticalListSortingStrategy } from '@dnd-kit/sortable';

function ProcessList({ processes, onReorder }) {
  const handleDragEnd = (event) => {
    const { active, over } = event;
    if (active.id !== over.id) {
      onReorder(active.id, over.id);
    }
  };

  return (
    <DndContext collisionDetection={closestCenter} onDragEnd={handleDragEnd}>
      <SortableContext items={processes} strategy={verticalListSortingStrategy}>
        {processes.map(process => (
          <SortableItem key={process.id} process={process} />
        ))}
      </SortableContext>
    </DndContext>
  );
}
```

---

#### 10. ğŸ”§ ç¼ºå°‘é”®ç›˜å¿«æ·é”®

**å»ºè®®å¿«æ·é”®**:
| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| `Space` | æ’­æ”¾/æš‚åœ |
| `â†` / `â†’` | ä¸Šä¸€ä¸ª/ä¸‹ä¸€ä¸ªå·¥åº |
| `Ctrl+N` | æ–°å»ºå·¥åº |
| `Ctrl+E` | ç¼–è¾‘å½“å‰å·¥åº |
| `Delete` | åˆ é™¤å½“å‰å·¥åº |
| `1-5` | è®¾ç½®æ’­æ”¾é€Ÿåº¦ |

**å®ç°æ–¹æ¡ˆ**:
```jsx
useEffect(() => {
  const handleKeyDown = (e) => {
    if (e.code === 'Space') {
      e.preventDefault();
      togglePlay();
    }
    if (e.code === 'ArrowLeft') navigatePrev();
    if (e.code === 'ArrowRight') navigateNext();
  };

  window.addEventListener('keydown', handleKeyDown);
  return () => window.removeEventListener('keydown', handleKeyDown);
}, []);
```

---

#### 11. ğŸ”§ ç¼ºå°‘æ•°æ®å¯¼å‡ºåŠŸèƒ½

**å»ºè®®æ”¯æŒæ ¼å¼**:
- PDF æŠ¥å‘Šï¼ˆåŒ…å«ç»Ÿè®¡å›¾è¡¨å’Œè§†é¢‘æˆªå›¾ï¼‰
- Excel æ•°æ®è¡¨ï¼ˆå·¥åºæ—¶é—´æ˜ç»†ï¼‰
- JSON å¤‡ä»½æ–‡ä»¶

**ä¾èµ–åº“**:
- PDF: `jspdf` + `html2canvas`
- Excel: `xlsx`

---

#### 12. ğŸ”§ è§†é¢‘æ’­æ”¾ä¼˜åŒ–

**å½“å‰é—®é¢˜**:
- åˆ‡æ¢å·¥åºæ—¶æœ‰åŠ è½½å»¶è¿Ÿ
- ä¸¤ä¸ªè§†é¢‘åŒæ­¥æ’­æ”¾å¯èƒ½æœ‰åå·®

**ä¼˜åŒ–æ–¹æ¡ˆ**:
1. é¢„åŠ è½½ä¸‹ä¸€ä¸ªå·¥åºçš„è§†é¢‘æ—¶é—´ç‚¹
2. ä½¿ç”¨ `requestAnimationFrame` ç²¾ç¡®åŒæ­¥
3. æ·»åŠ è§†é¢‘ç¼“å†²è¿›åº¦æ˜¾ç¤º

```javascript
// é¢„åŠ è½½ä¼˜åŒ–
const preloadNextSegment = (video, nextProcess) => {
  video.currentTime = nextProcess.start_time;
  video.preload = 'auto';
};

// åŒæ­¥æ ¡æ­£
const syncVideos = () => {
  const drift = Math.abs(beforeVideo.currentTime - afterVideo.currentTime);
  if (drift > 0.1) {  // åå·®è¶…è¿‡100ms
    afterVideo.currentTime = beforeVideo.currentTime;
  }
};
```

---

### P3 - ä½ä¼˜å…ˆçº§ï¼ˆæ”¹è¿›é¡¹ï¼‰

#### 13. ğŸ“ æ ·å¼æ–‡ä»¶éœ€è¦æ¨¡å—åŒ–

**å½“å‰é—®é¢˜**: æ‰€æœ‰æ ·å¼åœ¨ `App.css` ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ˆ700+è¡Œï¼‰

**ä¿®å¤æ–¹æ¡ˆ**: ä½¿ç”¨ CSS Modules
```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ProjectList/
â”‚   â”‚   â”œâ”€â”€ index.jsx
â”‚   â”‚   â””â”€â”€ styles.module.css
â”‚   â”œâ”€â”€ VideoPlayer/
â”‚   â”‚   â”œâ”€â”€ index.jsx
â”‚   â”‚   â””â”€â”€ styles.module.css
â”‚   â””â”€â”€ ...
â””â”€â”€ styles/
    â””â”€â”€ global.css
```

---

#### 14. ğŸ“ ç¼ºå°‘åº”ç”¨æ‰“åŒ…é…ç½®

**å½“å‰çŠ¶æ€**: æ— æ³•ç”Ÿæˆå¯åˆ†å‘çš„å®‰è£…åŒ…

**éœ€è¦æ·»åŠ **: `electron-builder` é…ç½®

```json
// package.json æ·»åŠ 
{
  "build": {
    "appId": "com.kaizen.showcase",
    "productName": "æ”¹å–„æ•ˆæœå±•ç¤ºç³»ç»Ÿ",
    "directories": {
      "output": "release"
    },
    "mac": {
      "category": "public.app-category.productivity",
      "target": ["dmg", "zip"]
    },
    "win": {
      "target": ["nsis", "portable"]
    }
  }
}
```

---

#### 15. ğŸ“ ç¼ºå°‘ä»£ç è§„èŒƒé…ç½®

**éœ€è¦æ·»åŠ **:
- ESLint é…ç½®
- Prettier é…ç½®
- Husky + lint-stagedï¼ˆæäº¤å‰æ£€æŸ¥ï¼‰

```json
// .eslintrc.json
{
  "extends": ["react-app"],
  "rules": {
    "no-unused-vars": "warn",
    "react-hooks/exhaustive-deps": "warn"
  }
}
```

---

#### 16. ğŸ“ å…¶ä»–æ”¹è¿›é¡¹

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| æš—é»‘æ¨¡å¼ | æ·»åŠ ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ |
| å›½é™…åŒ– | ä½¿ç”¨ react-i18next æ”¯æŒå¤šè¯­è¨€ |
| æ–°æ‰‹å¼•å¯¼ | ä½¿ç”¨ react-joyride æ·»åŠ ä½¿ç”¨æŒ‡å¼• |
| æ•°æ®å¤‡ä»½ | è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“åˆ°æœ¬åœ° |
| æ’¤é”€/é‡åš | å®ç°æ“ä½œå†å²è®°å½• |

---

## å®æ–½å»ºè®®

### ç¬¬ä¸€é˜¶æ®µï¼ˆ1å‘¨ï¼‰- ä¿®å¤å…³é”®é—®é¢˜ âœ… å·²å®Œæˆ
- [x] P0-1: ä¿®å¤ webSecurity å®‰å…¨é—®é¢˜ âœ…
- [x] P0-2: æ·»åŠ å…¨å±€é”™è¯¯å¤„ç† âœ…
- [x] P1-3: æ›¿æ¢åŸç”Ÿ confirm å¯¹è¯æ¡† âœ…
- [x] P1-4: æå–å…¬å…±å·¥å…·å‡½æ•° âœ…
- [x] æ·»åŠ  Toast é€šçŸ¥ç»„ä»¶ âœ…
- [x] ä¸ºæ‰€æœ‰ç»„ä»¶æ·»åŠ  try-catch é”™è¯¯å¤„ç† âœ…

### ç¬¬äºŒé˜¶æ®µï¼ˆ1-2å‘¨ï¼‰- æå‡ä½“éªŒ âœ… å·²å®Œæˆ
- [x] P1-5: æ·»åŠ  Loading çŠ¶æ€ âœ…
- [x] P1-6: æ·»åŠ  PropTypes ç±»å‹å®šä¹‰ âœ…
- [x] P1-7: æ€§èƒ½ä¼˜åŒ– (React.memo) âœ…
- [x] P2-9: å®ç°å·¥åºæ‹–æ‹½æ’åº âœ…
- [x] P2-10: æ·»åŠ é”®ç›˜å¿«æ·é”® âœ…
- [x] P2-11: æ·»åŠ æ•°æ®å¯¼å‡ºåŠŸèƒ½ âœ…

### ç¬¬ä¸‰é˜¶æ®µï¼ˆ2å‘¨ï¼‰- åŠŸèƒ½å®Œå–„
- [ ] P2-7: æ·»åŠ å•å…ƒæµ‹è¯•
- [ ] P2-8: ä¼˜åŒ–çŠ¶æ€ç®¡ç† (Context)
- [ ] P2-12: è§†é¢‘æ’­æ”¾ä¼˜åŒ–

### ç¬¬å››é˜¶æ®µï¼ˆæŒç»­ï¼‰- æŒç»­æ”¹è¿›
- [ ] P3 é¡¹ç›®æŒ‰éœ€å®æ–½

---

## æŠ€æœ¯å€ºåŠ¡è¯„ä¼°

| ç»´åº¦ | å½“å‰è¯„åˆ† | ç›®æ ‡è¯„åˆ† | å¤‡æ³¨ |
|------|----------|----------|------|
| ä»£ç è´¨é‡ | 6/10 | 8/10 | éœ€æ·»åŠ ç±»å‹æ£€æŸ¥å’Œæµ‹è¯• |
| å®‰å…¨æ€§ | 4/10 | 9/10 | å¿…é¡»ä¿®å¤ webSecurity |
| æ€§èƒ½ | 7/10 | 8/10 | è§†é¢‘åŒæ­¥éœ€ä¼˜åŒ– |
| å¯ç»´æŠ¤æ€§ | 6/10 | 8/10 | éœ€è¦æ¨¡å—åŒ–é‡æ„ |
| ç”¨æˆ·ä½“éªŒ | 7/10 | 9/10 | æ·»åŠ å¿«æ·é”®å’Œäº¤äº’ä¼˜åŒ– |
| å¯æ‰©å±•æ€§ | 5/10 | 8/10 | éœ€è¦çŠ¶æ€ç®¡ç†ä¼˜åŒ– |

**å½“å‰ç»¼åˆè¯„åˆ†: 5.8/10**
**ç›®æ ‡ç»¼åˆè¯„åˆ†: 8.3/10**

---

## é™„å½•ï¼šæ–‡ä»¶ä¿®æ”¹æ¸…å•

| ä¼˜å…ˆçº§ | é—®é¢˜ | æ¶‰åŠæ–‡ä»¶ |
|--------|------|----------|
| P0 | webSecurity | electron/main.js |
| P0 | é”™è¯¯å¤„ç† | æ‰€æœ‰ç»„ä»¶æ–‡ä»¶ |
| P1 | confirmå¯¹è¯æ¡† | ProjectList, StageManager, ProcessList |
| P1 | é‡å¤å‡½æ•° | ProcessList, VideoPlayer, ComparePlayer |
| P1 | LoadingçŠ¶æ€ | æ‰€æœ‰ç»„ä»¶æ–‡ä»¶ |
| P1 | ç±»å‹æ£€æŸ¥ | æ‰€æœ‰ç»„ä»¶æ–‡ä»¶ |
| P2 | çŠ¶æ€ç®¡ç† | App.jsx, æ–°å»º context æ–‡ä»¶ |
| P2 | æ‹–æ‹½æ’åº | ProcessList.jsx |
| P2 | å¿«æ·é”® | VideoPlayer, ComparePlayer |
