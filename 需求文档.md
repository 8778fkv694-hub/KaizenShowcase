# 改善效果展示系统 - 需求文档

## 1. 项目概述

### 1.1 项目背景
工艺改善效果展示系统是一款基于 Electron 的桌面应用程序，用于展示生产工艺改善前后的对比效果。通过视频分段播放和数据统计，直观展现改善成果。

### 1.2 技术栈
- **前端框架**: React 18.2
- **桌面框架**: Electron 28
- **构建工具**: Vite 5
- **数据库**: SQLite (better-sqlite3)
- **样式**: 原生 CSS

## 2. 功能需求

### 2.1 项目管理

#### 2.1.1 创建项目
- **功能描述**: 用户可以创建新的改善项目
- **输入项**:
  - 项目名称（必填）
  - 项目描述（可选）
- **实现状态**: ✅ 已实现
- **位置**: `src/components/ProjectList.jsx`

#### 2.1.2 查看项目列表
- **功能描述**: 以卡片形式展示所有项目
- **显示信息**:
  - 项目名称
  - 项目描述
  - 最后更新时间
- **实现状态**: ✅ 已实现
- **位置**: `src/components/ProjectList.jsx`

#### 2.1.3 删除项目
- **功能描述**: 删除项目及其所有关联数据
- **安全措施**: 删除前需要用户确认
- **实现状态**: ✅ 已实现
- **位置**: `src/components/ProjectList.jsx`

---

### 2.2 改善阶段管理

#### 2.2.1 创建阶段
- **功能描述**: 在项目下创建多个改善阶段
- **输入项**:
  - 阶段名称（必填）
  - 阶段描述（可选）
- **实现状态**: ✅ 已实现
- **位置**: `src/components/StageManager.jsx`

#### 2.2.2 视频文件管理
- **功能描述**: 为每个阶段上传改善前后的视频
- **支持方式**:
  - ✅ 文件选择器（已实现）
  - ⚠️ 拖拽上传（基础支持，可增强）
- **支持格式**: MP4, AVI, MOV, MKV, WEBM
- **实现状态**: ✅ 已实现
- **位置**: `src/components/StageManager.jsx`

#### 2.2.3 阶段状态显示
- **功能描述**: 显示阶段配置状态
- **状态类型**:
  - ✓ 已配置（两个视频都已上传）
  - ⚠ 待配置（视频未完全上传）
- **实现状态**: ✅ 已实现
- **位置**: `src/components/StageManager.jsx`

#### 2.2.4 切换阶段
- **功能描述**: 在多个阶段之间切换
- **实现状态**: ✅ 已实现
- **位置**: `src/components/StageManager.jsx`

#### 2.2.5 删除阶段
- **功能描述**: 删除阶段及其所有工序数据
- **安全措施**: 删除前需要用户确认
- **实现状态**: ✅ 已实现
- **位置**: `src/components/StageManager.jsx`

---

### 2.3 工序管理

#### 2.3.1 创建工序
- **功能描述**: 为视频创建时间分段工序
- **输入项**:
  - 工序名称（必填）- 例如："工序A - 物料准备"
  - 工序描述（可选）
  - 改善说明（可选）- 记录改善内容和效果
  - 改善前开始时间（必填）- 单位：秒
  - 改善前结束时间（必填）- 单位：秒
  - 改善后开始时间（必填）- 单位：秒
  - 改善后结束时间（必填）- 单位：秒
- **自动计算**:
  - 改善前时长 = 改善前结束时间 - 改善前开始时间
  - 改善后时长 = 改善后结束时间 - 改善后开始时间
  - 节省时间 = 改善前时长 - 改善后时长
- **实现状态**: ✅ 已实现
- **位置**: `src/components/ProcessList.jsx`, `electron/database.js`

#### 2.3.2 编辑工序
- **功能描述**: 修改工序的所有信息
- **实时预览**: 编辑时显示时长和节省时间预览
- **实现状态**: ✅ 已实现
- **位置**: `src/components/ProcessList.jsx`

#### 2.3.3 删除工序
- **功能描述**: 删除指定工序
- **安全措施**: 删除前需要用户确认
- **实现状态**: ✅ 已实现
- **位置**: `src/components/ProcessList.jsx`

#### 2.3.4 工序列表显示
- **功能描述**: 显示当前阶段的所有工序
- **显示信息**:
  - 工序序号（自动编号）
  - 工序名称
  - 改善前时长
  - 改善后时长
  - 节省时间
- **实现状态**: ✅ 已实现
- **位置**: `src/components/ProcessList.jsx`

#### 2.3.5 总时间统计
- **功能描述**: 显示所有工序的总节省时间
- **计算方式**: 自动汇总所有工序的节省时间
- **实现状态**: ✅ 已实现
- **位置**: `src/components/ProcessList.jsx`, `electron/database.js`

---

### 2.4 视频播放功能

#### 2.4.1 单工序播放
- **功能描述**: 播放选中工序的视频片段
- **播放模式**:
  - 改善前视频片段
  - 改善后视频片段
  - 可切换模式
- **播放控制**:
  - ✅ 播放/暂停按钮
  - ✅ 进度条显示
  - ✅ 时间显示（当前/总时长）
  - ✅ 自动停止（到达结束时间）
- **实现状态**: ✅ 已实现
- **位置**: `src/components/VideoPlayer.jsx`

#### 2.4.2 对比播放
- **功能描述**: 同时播放改善前后视频进行对比
- **布局模式**:
  - ✅ 左右布局（改善前在左，改善后在右）
  - ✅ 上下布局（改善前在上，改善后在下）
  - ✅ 可切换布局
- **同步播放**:
  - ✅ 两个视频同时开始
  - ✅ 各自显示独立进度条
  - ✅ 到达结束时间时同时停止
- **显示信息**:
  - ✅ 工序名称
  - ✅ 各自的时长
  - ✅ 节省时间
  - ✅ 改善说明
- **实现状态**: ✅ 已实现
- **位置**: `src/components/ComparePlayer.jsx`

#### 2.4.3 全局播放
- **功能描述**: 连续播放所有工序
- **播放逻辑**:
  - ✅ 按工序顺序依次播放
  - ✅ 显示当前播放的工序
  - ✅ 显示工序进度（例如：2/5）
  - ✅ 支持手动切换下一个工序
  - ✅ 播放完所有工序后停止
- **显示信息**:
  - ✅ 当前工序名称
  - ✅ 工序进度
  - ✅ 总节省时间
- **实现状态**: ✅ 已实现
- **位置**: `src/components/ComparePlayer.jsx`

#### 2.4.4 进度条效果
- **功能描述**: 动态显示播放进度
- **效果要求**:
  - ✅ 实时更新进度条
  - ✅ 渐变色样式
  - ✅ 平滑过渡动画
- **实现状态**: ✅ 已实现
- **位置**: `src/styles/App.css`

---

### 2.5 数据持久化

#### 2.5.1 数据库表结构
- **projects 表** - 项目信息
  - ✅ id: 主键
  - ✅ name: 项目名称
  - ✅ description: 项目描述
  - ✅ created_at: 创建时间
  - ✅ updated_at: 更新时间

- **stages 表** - 改善阶段
  - ✅ id: 主键
  - ✅ project_id: 所属项目
  - ✅ name: 阶段名称
  - ✅ description: 阶段描述
  - ✅ before_video_path: 改善前视频路径
  - ✅ after_video_path: 改善后视频路径
  - ✅ created_at: 创建时间

- **processes 表** - 工序信息
  - ✅ id: 主键
  - ✅ stage_id: 所属阶段
  - ✅ name: 工序名称
  - ✅ description: 工序描述
  - ✅ improvement_note: 改善说明
  - ✅ before_start_time: 改善前开始时间
  - ✅ before_end_time: 改善前结束时间
  - ✅ after_start_time: 改善后开始时间
  - ✅ after_end_time: 改善后结束时间
  - ✅ time_saved: 节省时间（自动计算）
  - ✅ sort_order: 排序序号

#### 2.5.2 级联删除
- **功能描述**: 删除上级数据时自动删除关联数据
- **级联关系**:
  - ✅ 删除项目 → 删除所有阶段 → 删除所有工序
  - ✅ 删除阶段 → 删除所有工序
- **实现状态**: ✅ 已实现
- **位置**: `electron/database.js`

---

### 2.6 用户界面

#### 2.6.1 整体布局
- **布局结构**:
  - ✅ 顶部标题栏：显示项目名称和当前阶段
  - ✅ 左侧边栏：项目、阶段、工序管理
  - ✅ 主内容区：视频播放和控制
- **响应式设计**:
  - ✅ 支持不同窗口尺寸
  - ✅ 最小宽度限制
- **实现状态**: ✅ 已实现
- **位置**: `src/App.jsx`, `src/styles/App.css`

#### 2.6.2 颜色主题
- **主色调**: 紫色渐变（#667eea → #764ba2）
- **辅助色**:
  - ✅ 成功/节省时间: 绿色 (#10b981)
  - ✅ 警告: 橙色 (#f59e0b)
  - ✅ 危险/删除: 红色 (#dc2626)
  - ✅ 信息: 蓝色 (#3b82f6)
- **实现状态**: ✅ 已实现
- **位置**: `src/styles/App.css`

#### 2.6.3 交互反馈
- **悬停效果**:
  - ✅ 按钮悬停变色
  - ✅ 卡片悬停抬升
  - ✅ 图标按钮放大
- **过渡动画**:
  - ✅ 颜色渐变
  - ✅ 位置移动
  - ✅ 模态框淡入
- **实现状态**: ✅ 已实现
- **位置**: `src/styles/App.css`

#### 2.6.4 空状态提示
- **提示类型**:
  - ✅ 无项目时的引导
  - ✅ 无阶段时的提示
  - ✅ 无视频时的提示
  - ✅ 无工序时的提示
- **实现状态**: ✅ 已实现
- **位置**: 各组件中

---

## 3. 非功能需求

### 3.1 性能要求
- ✅ 应用启动时间 < 3秒
- ✅ 数据库查询响应 < 100ms
- ✅ 视频切换流畅无卡顿
- **实现状态**: ✅ 已满足

### 3.2 兼容性要求
- ✅ 操作系统: macOS, Windows, Linux
- ✅ 视频格式: MP4, AVI, MOV, MKV, WEBM
- **实现状态**: ✅ 已实现

### 3.3 安全性要求
- ✅ 删除操作需要确认
- ✅ 数据库使用本地存储
- ✅ 不涉及网络传输
- **实现状态**: ✅ 已实现

### 3.4 易用性要求
- ✅ 界面简洁直观
- ✅ 操作流程清晰
- ✅ 提供必要的操作提示
- **实现状态**: ✅ 已实现

---

## 4. 数据流程

### 4.1 创建改善项目流程
1. ✅ 用户点击"新建项目"
2. ✅ 填写项目名称和描述
3. ✅ 系统创建项目记录并自动选中
4. ✅ 进入项目工作界面

### 4.2 配置改善阶段流程
1. ✅ 用户创建阶段
2. ✅ 上传改善前视频
3. ✅ 上传改善后视频
4. ✅ 阶段状态变为"已配置"

### 4.3 添加工序流程
1. ✅ 用户点击"新建工序"
2. ✅ 填写工序信息和时间段
3. ✅ 系统自动计算时间节省
4. ✅ 工序添加到列表并自动排序

### 4.4 对比播放流程
1. ✅ 用户选择工序
2. ✅ 点击"对比播放"
3. ✅ 系统同时加载两个视频
4. ✅ 定位到指定时间段
5. ✅ 同步播放并显示进度
6. ✅ 到达结束时间自动停止

### 4.5 全局播放流程
1. ✅ 用户点击"全局播放"
2. ✅ 系统从第一个工序开始
3. ✅ 播放完一个工序后自动播放下一个
4. ✅ 显示当前工序和总进度
5. ✅ 播放完所有工序后停止

---

## 5. 功能实现清单

### 5.1 核心功能（100%完成）
- ✅ 项目管理（创建、查看、删除）
- ✅ 阶段管理（创建、编辑、切换、删除）
- ✅ 工序管理（创建、编辑、删除、自动计算）
- ✅ 视频文件选择
- ✅ 单工序播放
- ✅ 对比播放
- ✅ 全局播放
- ✅ 进度条显示
- ✅ 时间统计
- ✅ 数据持久化

### 5.2 增强功能（部分完成）
- ✅ 布局切换（左右/上下）
- ⚠️ 拖拽上传（基础支持，可增强体验）
- ❌ 工序拖拽排序（未实现）
- ❌ 导出报告功能（未实现）
- ❌ 截图功能（未实现）

### 5.3 优化项（可选）
- ❌ 视频预览缩略图
- ❌ 键盘快捷键
- ❌ 工序复制功能
- ❌ 批量导入工序
- ❌ 数据导出/导入

---

## 6. 使用场景

### 6.1 场景一：记录单次改善
1. 创建项目"生产线A优化"
2. 创建阶段"初步改善"
3. 上传改善前后视频
4. 添加工序（物料准备、组装、检测等）
5. 使用对比播放展示改善效果

### 6.2 场景二：多阶段持续改善
1. 创建项目"车间B效率提升"
2. 创建阶段1"第一轮改善"
3. 记录初始改善效果
4. 创建阶段2"第二轮改善"
5. 记录进一步优化效果
6. 对比不同阶段的改善成果

### 6.3 场景三：改善成果展示
1. 打开已完成的项目
2. 选择要展示的阶段
3. 使用全局播放展示所有工序
4. 通过总时间节省数据说明效果

---

## 7. 技术实现要点

### 7.1 Electron 主进程
- ✅ 窗口管理
- ✅ IPC 通信
- ✅ 文件对话框
- ✅ 数据库初始化

### 7.2 Electron 渲染进程
- ✅ React 组件化开发
- ✅ 状态管理（useState, useEffect）
- ✅ 视频播放控制
- ✅ 用户交互处理

### 7.3 数据库操作
- ✅ SQLite 本地存储
- ✅ 增删改查操作
- ✅ 级联删除
- ✅ 自动计算字段

### 7.4 视频处理
- ✅ HTML5 Video API
- ✅ 精确时间定位
- ✅ 同步播放控制
- ✅ 进度跟踪

---

## 8. 项目文件结构

```
改善对比/
├── electron/                 # Electron 主进程
│   ├── main.js              # ✅ 主进程入口
│   ├── database.js          # ✅ 数据库管理
│   └── preload.js           # ✅ 预加载脚本
├── src/                      # React 应用源码
│   ├── components/          # ✅ 组件目录
│   │   ├── ProjectList.jsx  # ✅ 项目列表
│   │   ├── StageManager.jsx # ✅ 阶段管理
│   │   ├── ProcessList.jsx  # ✅ 工序列表
│   │   ├── VideoPlayer.jsx  # ✅ 视频播放器
│   │   └── ComparePlayer.jsx# ✅ 对比播放器
│   ├── styles/              # ✅ 样式文件
│   │   └── App.css          # ✅ 主样式
│   ├── App.jsx              # ✅ 主应用组件
│   └── index.jsx            # ✅ 入口文件
├── public/                   # 公共资源
│   └── index.html           # ✅ HTML 模板
├── package.json             # ✅ 项目配置
├── vite.config.js           # ✅ Vite 配置
└── 需求文档.md              # ✅ 本文档
```

---

## 9. 待完善功能建议

### 9.1 高优先级
1. **拖拽增强**
   - 优化拖拽上传体验
   - 添加拖拽区域视觉反馈

2. **工序排序**
   - 实现工序拖拽排序
   - 支持手动调整工序顺序

### 9.2 中优先级
1. **导出功能**
   - 导出改善报告（PDF）
   - 导出数据（Excel/CSV）

2. **截图功能**
   - 工序关键帧截图
   - 对比截图生成

### 9.3 低优先级
1. **键盘快捷键**
   - 空格播放/暂停
   - 方向键切换工序

2. **数据备份**
   - 数据库导出/导入
   - 项目打包分享

---

## 10. 总结

本系统已完成所有核心功能需求，实现了：
- ✅ 完整的项目、阶段、工序三级管理
- ✅ 灵活的视频播放模式（单工序、对比、全局）
- ✅ 自动时间计算和统计
- ✅ 美观的用户界面和流畅的交互体验
- ✅ 可靠的数据持久化

系统可以立即投入使用，支持工艺改善效果的记录、管理和展示。
